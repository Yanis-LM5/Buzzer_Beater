<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_news.css"/>
    <link rel="shortcut icon" href="logo_bb.png" type="image/x-icon">
    <title>BB News</title>
</head>
<body>
    <header>
        <ul>
            <li><img src= "logo_bb.png" alt= "logo"></li>
            <li> <a href="bb_menu.html">Home</a></li>
            <li><a href="bb_news.html">News </a></li>
            <li> <a href="bb_teams.html">Teams</a></li>
            <li> Results</li>
            <li> Map</li>
            <li> Message</li>
            <li> Connect</li>

        </ul>
    </header>

    <h1>BB News</h1>

    <script>

    // flux rss l'equipe https://dwh.lequipe.fr/api/edito/rss?path=/Basket/

    const url = "https://corsproxy.io/?https://rmcsport.bfmtv.com/rss/basket/nba/";
    getxt(url);
    async function getxt(url) {
    console.log(1);
    let x = await fetch(url);
    let y = await x.text();
    console.log(2);
    console.log(y.substring());
    xmlParser = new DOMParser();
    console.log(3);
    let xmlDoc = xmlParser.parseFromString(y, "text/xml");
    console.log(xmlDoc);
    let item = xmlDoc.getElementsByTagName("item");
    console.log(item);
    console.log(item.length);

    for (let i=0; i<item.length; i++){

        let paragraphe = document.createElement("div");
        const body = document.body;

        //Item (article)
        let item_i= xmlDoc.querySelectorAll("item")[i];

        //Title (of the article)
        let title = document.createElement("h3");
        let title_i= item_i.querySelector("title");
        title.append(title_i.textContent);

        //Image (of the article)
        const img = new Image();
        img.src = item_i.querySelector("enclosure").getAttribute("url");
        document.body.appendChild(img);

        //Date (of the article)
        let date= document.createElement("p");
        let date_i= item_i.querySelector("pubDate");
        date.append(date_i.textContent);

        //Text Content (of the article) (1st line...)
        let txt= document.createElement("p");
        let txt1_i= item_i.querySelector("description")
        txt.append(txt1_i.textContent.substring(0, txt1_i.textContent.search("<")))

        //Searching for the rest of the Text Content (Rest line)
        lettxt = xmlDoc.querySelectorAll("link")[i].textContent;
        const secondUrl = "############https://corsproxy.io/?" + lettxt;
        console.log(lettxt)
        let fetch_txt = await fetch(secondUrl);
        let fetch_txt_y = await fetch_txt.text();
        htmlParser_txt = new DOMParser();
        let htmlDoc_txt = htmlParser_txt.parseFromString(fetch_txt_y, "text/html");



        let test = htmlDoc_txt.querySelector(".grid_wrapper");



        if (test){
            console.log("ok");
            let begin_txt = test.textContent.indexOf("NBA:");
            let end_txt = test.textContent.indexOf("NBANBA:", begin_txt + 1);
            console.log(test.textContent.length);
            article = test.textContent.substring(begin_txt + 4, end_txt);
            console.log(article);
            txt.append(test.textContent.substring(begin_txt, end_txt))
        }

        else{
        console.log("error 2nd fetch api")}


            paragraphe.appendChild(title);
            paragraphe.appendChild(img);
            paragraphe.appendChild(date)
            paragraphe.appendChild(txt)
            body.appendChild(paragraphe);

    }
    }
    </script>

</body>
</html>
