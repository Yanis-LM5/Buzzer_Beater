<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_teams.css"/>
    <title>Buzzer Beater - Créer un compte</title>
    <link rel="shortcut icon" href="logo_bb.png" type="image/x-icon">
    <script src="https://kit.fontawesome.com/3ca4fe2b8a.js"></script>
</head>

<body class="login-body">
<header>
    <input type="checkbox" id="check">
    <label for="check" class="checkbox">&#9776;</label>
    <nav class="navbar">
        <ul>
            <li><img src="logo_bb.png" alt="logo"></li>
            <li><a href="bb_menu.html">Home</a></li>
            <li><a href="bb_news.html">News</a></li>
            <li><a href="bb_teams.html">Teams</a></li>
            <li>Results</li>
            <li><a href="http://localhost:5173">Map</a></li>
            <li><a href="bb_forum.html">Forum</a></li>
            <li class="nav-active"><a href="login.html">Connect</a></li>
        </ul>
    </nav>
</header>

<div class="login-bg register-bg">
    <div class="login-overlay"></div>

    <div class="login-wrapper register-wrapper">
        <div class="login-card">

            <!-- Brand -->
            <div class="login-brand">
                <img src="logo_bb.png" alt="Buzzer Beater Logo" class="login-logo">
                <h1>Buzzer<span>Beater</span></h1>
                <p>Rejoins la communauté NBA</p>
            </div>

            <!-- Form -->
            <form class="login-form" action="" method="post" id="register-form" novalidate>
                <div class="input-group">
                    <label for="username">Nom d'utilisateur</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-user"></i>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            placeholder="Choisis un pseudo..."
                            required
                            autocomplete="username"
                            minlength="3"
                            maxlength="20"
                        >
                    </div>
                    <span class="field-hint">Entre 3 et 20 caractères</span>
                </div>
                <div class="input-group">
                    <label for="email">Adresse e-mail</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-envelope"></i>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="ton@email.com"
                            required
                            autocomplete="email"
                        >
                        <span class="field-status" id="email-status"></span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="password">Mot de passe</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-lock"></i>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            placeholder="••••••••"
                            required
                            autocomplete="new-password"
                            minlength="8"
                        >
                        <button type="button" class="toggle-pwd" onclick="togglePassword('password', 'eye-icon-1')" aria-label="Afficher/masquer">
                            <i class="fa-solid fa-eye" id="eye-icon-1"></i>
                        </button>
                    </div>
                </div>
                <div class="input-group">
                    <label for="confirm-password">Confirmer le mot de passe</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-shield-halved"></i>
                        <input
                            type="password"
                            id="confirm-password"
                            name="confirm_password"
                            placeholder="••••••••"
                            required
                            autocomplete="new-password"
                        >
                        <button type="button" class="toggle-pwd" onclick="togglePassword('confirm-password', 'eye-icon-2')" aria-label="Afficher/masquer">
                            <i class="fa-solid fa-eye" id="eye-icon-2"></i>
                        </button>
                    </div>
                    <span class="match-hint" id="match-hint"></span>
                </div>
                <button type="submit" class="btn-login">
                    <i class="fa-solid fa-user-plus"></i>
                    Créer mon compte
                </button>

            </form>
            <div class="login-register">
                <p>Déjà un compte ? <a href="login.html">Se connecter</a></p>
            </div>

        </div>
    </div>
</div>

<script>
    /* --- Mot De Passe Visible ou non --- */
    function togglePassword(inputId, iconId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    /* --- Verif mot de passe --- */
    const pwdInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm-password');
    const matchHint = document.getElementById('match-hint');

    confirmInput.addEventListener('input', function () {
        if (this.value === '') {
            matchHint.textContent = '';
            return;
        }
        if (this.value === pwdInput.value) {
            matchHint.textContent = '✓ Les mots de passe correspondent';
            matchHint.style.color = '#43a047';
        } else {
            matchHint.textContent = '✗ Les mots de passe ne correspondent pas';
            matchHint.style.color = '#e53935';
        }
    });

    /* --- Email live validation --- */
    const emailInput = document.getElementById('email');
    const emailStatus = document.getElementById('email-status');

    emailInput.addEventListener('input', function () {
        const val = this.value.trim();
        const valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val);
        if (val.length === 0) {
            emailStatus.textContent = '';
        } else if (!valid) {
            emailStatus.className = 'field-status status-error';
            emailStatus.innerHTML = '<i class="fa-solid fa-xmark"></i>';
        } else {
            emailStatus.className = 'field-status status-ok';
            emailStatus.innerHTML = '<i class="fa-solid fa-check"></i>';
        }
    });

    /* --- Inscription via API --- */
    document.getElementById('register-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const username = document.getElementById('username').value.trim();
        const email    = document.getElementById('email').value.trim();
        const password = pwdInput.value;
        const confirm  = confirmInput.value;

        let errorEl = document.getElementById('register-error');
        if (!errorEl) {
            errorEl = document.createElement('p');
            errorEl.id = 'register-error';
            errorEl.style.cssText = 'color:#e53935;text-align:center;margin-top:10px;font-size:0.9rem;';
            this.appendChild(errorEl);
        }
        errorEl.textContent = '';

        if (password !== confirm) {
            errorEl.textContent = 'Les mots de passe ne correspondent pas.';
            return;
        }

        const btn = this.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Création...';

        try {
            const res = await fetch('http://localhost:3000/api/users/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password })
            });
            if (!res.ok) {
                const msg = await res.json();
                errorEl.textContent = typeof msg === 'string' ? msg : 'Erreur lors de l\'inscription.';
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-user-plus"></i> Créer mon compte';
                return;
            }
            errorEl.style.color = '#43a047';
            errorEl.textContent = 'Compte créé ! Redirection vers la connexion...';
            setTimeout(() => { window.location.href = 'login.html'; }, 1500);
        } catch(err) {
            errorEl.textContent = 'Impossible de joindre le serveur.';
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-user-plus"></i> Créer mon compte';
        }
    });
</script>
<script src="navbar-auth.js"></script>

</body>
</html>
